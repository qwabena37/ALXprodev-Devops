#!/bin/bash
# Generate a formatted Pokémon report (CSV + averages)

OUTPUT_FILE="pokemon_report.csv"

# Header for CSV
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Extract data from JSON files and append to CSV
for file in *.json; do
    if [ -f "$file" ]; then
        name=$(jq -r '.name' "$file")
        height=$(jq -r '.height' "$file")
        weight=$(jq -r '.weight' "$file")

        # Convert height (dm → m) and weight (hg → kg)
        height_m=$(awk "BEGIN {printf \"%.1f\", $height/10}")
        weight_kg=$(awk "BEGIN {printf \"%.1f\", $weight/10}")

        echo "${name^},$height_m,$weight_kg" >> "$OUTPUT_FILE"
    fi
done

# Sort the CSV alphabetically by name (skip header)
{ head -n 1 "$OUTPUT_FILE"; tail -n +2 "$OUTPUT_FILE" | sort; } > temp.csv && mv temp.csv "$OUTPUT_FILE"

echo "CSV Report generated at: $OUTPUT_FILE"
echo
cat "$OUTPUT_FILE"
echo

# Calculate averages with awk
awk -F, 'NR>1 {
    sum_h+=$2; sum_w+=$3; count++
}
END {
    if (count>0)
        printf "\nAverage Height: %.2f m\nAverage Weight: %.2f kg\n", sum_h/count, sum_w/count;
}' "$OUTPUT_FILE"

